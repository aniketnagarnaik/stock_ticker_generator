<!DOCTYPE html>
<html>
<head>
    <title>Sparkline Test</title>
    <style>
        body { padding: 40px; font-family: Arial; }
        .container { max-width: 800px; margin: 0 auto; }
        svg { border: 1px solid #ccc; display: block; margin: 20px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>EPS Sparkline Test</h1>
        
        <h3>AAPL Sparkline</h3>
        <svg id="sparkline-AAPL" width="200" height="60"></svg>
        <button onclick="showChart()">Show Full Chart</button>
        
        <div id="output"></div>
    </div>
    
    <script>
        // Test data
        const testData = {
            symbol: 'AAPL',
            eps_history: {
                quarterly: {
                    '2024-06-30': 1.4,
                    '2024-09-30': 0.97,
                    '2024-12-31': 2.4,
                    '2025-03-31': 1.65,
                    '2025-06-30': 1.57
                }
            }
        };
        
        function drawSparkline() {
            console.log('Drawing sparkline...');
            const svg = document.getElementById('sparkline-AAPL');
            const quarterly = testData.eps_history.quarterly;
            const sortedQuarters = Object.entries(quarterly).sort((a, b) => a[0].localeCompare(b[0]));
            const values = sortedQuarters.map(([_, eps]) => eps);
            
            console.log('Values:', values);
            
            const width = 200;
            const height = 60;
            const padding = 5;
            
            const maxVal = Math.max(...values);
            const minVal = Math.min(...values);
            const range = maxVal - minVal || 1;
            
            const points = values.map((val, i) => {
                const x = padding + (i / (values.length - 1)) * (width - 2 * padding);
                const y = height - padding - ((val - minVal) / range) * (height - 2 * padding);
                return `${x},${y}`;
            }).join(' ');
            
            const trend = values[values.length - 1] >= values[0];
            const color = trend ? '#10b981' : '#ef4444';
            
            svg.innerHTML = `
                <polyline
                    points="${points}"
                    fill="none"
                    stroke="${color}"
                    stroke-width="3"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                />
                ${values.map((val, i) => {
                    const x = padding + (i / (values.length - 1)) * (width - 2 * padding);
                    const y = height - padding - ((val - minVal) / range) * (height - 2 * padding);
                    return `<circle cx="${x}" cy="${y}" r="3" fill="${color}" />`;
                }).join('')}
            `;
            
            document.getElementById('output').innerHTML = `
                <h3>Debug Info:</h3>
                <p>Quarters: ${sortedQuarters.length}</p>
                <p>Values: ${values.join(', ')}</p>
                <p>Min: ${minVal}, Max: ${maxVal}</p>
                <p>Trend: ${trend ? 'Up' : 'Down'}</p>
                <p>Color: ${color}</p>
            `;
            
            console.log('âœ… Sparkline drawn!');
        }
        
        function showChart() {
            alert('In the real app, this would show a detailed Chart.js chart!');
        }
        
        // Draw on load
        window.addEventListener('load', () => {
            drawSparkline();
        });
    </script>
</body>
</html>
